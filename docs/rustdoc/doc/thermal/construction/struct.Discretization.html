<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Represents the discretization of a [`Construction`] for heat transfer calculation purposes."><meta name="keywords" content="rust, rustlang, rust-lang, Discretization"><title>Discretization in thermal::construction - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>
<script>
  "use strict";
  document.addEventListener("DOMContentLoaded", function () {
      var maths = document.getElementsByClassName("language-math");
      for (var i=0; i<maths.length; i++) {
          var el = maths[i];
          katex.render(el.innerText, el, {displayMode: true});
      }

      var codes = document.getElementsByTagName("code");
      for (i=0; i<codes.length; i++) {
          el = codes[i];
          if (el.classList.contains("language-math")) continue;
          if (el.classList.contains("language-inline-math")) {
              katex.render(el.innerText, el);
              continue;
          }

          var parent = el.parentNode;
          if (parent.nodeName.toLowerCase() === "pre") continue;
          // TODO: Can this be done with DOM manipulation rather than string manipulation?
          // https://stackoverflow.com/q/48438067/3019990
          var inlineMath = "$" + el.outerHTML + "$";
          if (parent.innerHTML.indexOf(inlineMath) !== -1) {
              el.classList.add("language-inline-math");
              parent.innerHTML = parent.innerHTML.replace("$" + el.outerHTML + "$", el.outerHTML);
              i--;
          }
      }
  });
</script>

</head><body class="rustdoc struct"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../thermal/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../thermal/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Discretization</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#fields">Fields</a></h3><ul><li><a href="#structfield.segments">segments</a></li><li><a href="#structfield.tstep_subdivision">tstep_subdivision</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementations">Methods</a></h3><ul><li><a href="#method.build">build</a></li><li><a href="#method.chunk_segments">chunk_segments</a></li><li><a href="#method.discretize_construction">discretize_construction</a></li><li><a href="#method.get_chunks">get_chunks</a></li><li><a href="#method.get_k_q">get_k_q</a></li><li><a href="#method.new">new</a></li><li><a href="#method.r_value">r_value</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#synthetic-implementations">Auto Trait Implementations</a></h3><ul><li><a href="#impl-RefUnwindSafe">RefUnwindSafe</a></li><li><a href="#impl-Send">Send</a></li><li><a href="#impl-Sync">Sync</a></li><li><a href="#impl-Unpin">Unpin</a></li><li><a href="#impl-UnwindSafe">UnwindSafe</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#blanket-implementations">Blanket Implementations</a></h3><ul><li><a href="#impl-Any">Any</a></li><li><a href="#impl-Borrow%3CT%3E">Borrow&lt;T&gt;</a></li><li><a href="#impl-BorrowMut%3CT%3E">BorrowMut&lt;T&gt;</a></li><li><a href="#impl-From%3CT%3E">From&lt;T&gt;</a></li><li><a href="#impl-Into%3CU%3E">Into&lt;U&gt;</a></li><li><a href="#impl-TryFrom%3CU%3E">TryFrom&lt;U&gt;</a></li><li><a href="#impl-TryInto%3CU%3E">TryInto&lt;U&gt;</a></li></ul></div></section><h2 class="location"><a href="index.html">In thermal::construction</a></h2><div id="sidebar-vars" data-name="Discretization" data-ty="struct" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../thermal/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Struct <a href="../index.html">thermal</a>::<wbr><a href="index.html">construction</a>::<wbr><a class="struct" href="#">Discretization</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/thermal/construction.rs.html#72-85">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust struct"><code>pub struct Discretization {
    pub segments: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <a class="enum" href="enum.UValue.html" title="enum thermal::construction::UValue">UValue</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a>&gt;,
    pub tstep_subdivision: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>,
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Represents the discretization of a [<code>Construction</code>] for heat transfer
calculation purposes.</p>
<h2 id="note"><a href="#note">Note</a></h2>
<p>This object contains all the <a href="../cavity/struct.Cavity.html" title="Cavity"><code>Cavity</code></a> objects in it, which
contain information not only about their thickness but also their orientation.
This means that one <code>Discretization</code> should exist per <code>Surface</code>, not just by <code>Construction</code>.</p>
</div></details><h2 id="fields" class="fields small-section-header">Fields<a href="#fields" class="anchor"></a></h2><span id="structfield.segments" class="structfield small-section-header"><a href="#structfield.segments" class="anchor field"></a><code>segments: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <a class="enum" href="enum.UValue.html" title="enum thermal::construction::UValue">UValue</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a>&gt;</code></span><div class="docblock"><p>Contains the node’s mass and the <code>UValue</code> of each segment</p>
</div><span id="structfield.tstep_subdivision" class="structfield small-section-header"><a href="#structfield.tstep_subdivision" class="anchor field"></a><code>tstep_subdivision: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a></code></span><div class="docblock"><p>Contains the minimum number of timesteps per model timestep that
this discretization requires to ensure numerical stability and accuracy.</p>
<p>While the caller model—e.g., a Multiphysics Simulation model—may attempt
to simulate at a certain timestep, some of the constructions in it may
require smaller timesteps to ensure numerical stability and accuracy.
This means that—on each timestep in the caller model—the thermal model needs
to perform <code>time_subdivision</code> sub-timesteps.</p>
</div><h2 id="implementations" class="small-section-header">Implementations<a href="#implementations" class="anchor"></a></h2><div id="implementations-list"><details class="rustdoc-toggle implementors-toggle" open><summary><section id="impl" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#87-685">source</a></span><a href="#impl" class="anchor"></a><h3 class="code-header in-band">impl <a class="struct" href="struct.Discretization.html" title="struct thermal::construction::Discretization">Discretization</a></h3></section></summary><div class="impl-items"><details class="rustdoc-toggle method-toggle" open><summary><section id="method.new" class="method has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#93-104">source</a></span><a href="#method.new" class="anchor"></a><h4 class="code-header">pub fn <a href="#method.new" class="fnname">new</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;construction: &amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;Construction&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;model_dt: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;max_dx: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;min_dt: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;height: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;angle: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self, <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Creates a new <code>Discretization</code>.</p>
<p>It first calculates the <code>tstep_subdivision</code> and the number of elements
on each layer of Construction by calling <code>discretize_construction()</code>; and then builds the
<code>Discretization</code> by calling <code>build()</code>.</p>
</div></details><section id="method.chunk_segments" class="method has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#106-126">source</a></span><a href="#method.chunk_segments" class="anchor"></a><h4 class="code-header">fn <a href="#method.chunk_segments" class="fnname">chunk_segments</a>(&amp;self, indexes: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">&amp;[</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">]</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a>&gt;</h4></section><section id="method.get_chunks" class="method has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#127-143">source</a></span><a href="#method.get_chunks" class="anchor"></a><h4 class="code-header">pub fn <a href="#method.get_chunks" class="fnname">get_chunks</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a>&gt;, <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a>&gt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a></h4></section><details class="rustdoc-toggle method-toggle" open><summary><section id="method.build" class="method has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#146-286">source</a></span><a href="#method.build" class="anchor"></a><h4 class="code-header">fn <a href="#method.build" class="fnname">build</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;construction: &amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;Construction&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;tstep_subdivision: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;n_elements: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">&amp;[</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">]</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;height: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;angle: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self, <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Creates the <code>segments</code> of the <code>Discretization</code>.</p>
</div></details><details class="rustdoc-toggle method-toggle" open><summary><section id="method.r_value" class="method has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#293-307">source</a></span><a href="#method.r_value" class="anchor"></a><h4 class="code-header">pub fn <a href="#method.r_value" class="fnname">r_value</a>(&amp;self) -&gt; <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a></h4></section></summary><div class="docblock"><p>Calculates the R value of the whole system</p>
<h5 id="panics"><a href="#panics">Panics</a></h5>
<p>Panics if the calculated R value is Zero (i.e., if there are no
layers or something like that)</p>
</div></details><details class="rustdoc-toggle method-toggle" open><summary><section id="method.discretize_construction" class="method has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#396-525">source</a></span><a href="#method.discretize_construction" class="anchor"></a><h4 class="code-header">fn <a href="#method.discretize_construction" class="fnname">discretize_construction</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;construction: &amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;Construction&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;model_dt: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;max_dx: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;min_dt: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a><br>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>&gt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a></h4></section></summary><div class="docblock"><p>Given a Maximum element thickness ($<code>\Delta x_{max}</code>$) and a minimum timestep ($<code>\Delta t_{min}</code>$), this function
will find an arguibly good (i.e., stable and accurate) combination of $<code>\Delta t</code>$ and number of elements in each
layer of the construction.</p>
<p>This function recursively increases the model’s timestep subdivisions (<code>n</code>) in order to reduce $<code>\Delta t</code>$ to numbers
that respect the restrictions of (1) stability, (2) $<code>\Delta x_{max}</code>$, and (3) $<code>\Delta t_{min}</code>$. In other words,
it searches (by testing $<code>\Delta t_{model}/1</code>$, $<code>\Delta t_{model}/2</code>$, $<code>\Delta t_{model}/3</code>$, … $<code>\Delta t_{model}/n</code>$)
for the minimum <code>n</code> that respects this restrictions</p>
<h5 id="the-math-behind-it"><a href="#the-math-behind-it">The math behind it</a></h5>
<p>The first thing to know is that the walls in this module march
through time using a 4th order <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runga-Kutte</a>
(a.k.a., RK4). The second thing to know is that the RK4 method is
more stable than the <a href="https://en.wikipedia.org/wiki/Euler_method">Euler method</a>,
and thus the restrictions of stability for the Euler method can be considered
to be a conservative restriction for the RK4. Hence, this function uses the
Euler method restrictions.</p>
<p>We are solving the following equation:</p>
<div class="example-wrap"><pre class="language-math"><code>\dot{T} = \overline{C}^{-1} \overline{K}  T + \overline{C}^{-1} q</code></pre></div>
<p>And thus the stability of the numerical method will depend on the matrix:</p>
<div class="example-wrap"><pre class="language-math"><code>\overline{K}^{\star} =\Delta t \overline{C}^{-1} \overline{K}</code></pre></div>
<p>Specifically, we don’t want any of its <a href="https://en.wikipedia.org/wiki/Eigenvalues_and_eigenvectors">eigenvalues</a>
$<code>\xi_1, \xi_2,\xi_3, ...</code>$ to be outside of the Euler method’s stability region. Since this
matrix has onle Real eigenvalues, this is equivalent to saying:</p>
<div class="example-wrap"><pre class="language-math"><code>-2 &lt; \xi_i &lt; 0 ; \forall i</code></pre></div>
<p>However, finding the eigenvalues for $<code>\overline{K}^{\star}</code>$ is far from trivial. So there is
yet another heuristic I am using: I am treating the case of a wall with 1 layer that is subdivided
into a single element as the limit case. I am not sure if this is correct, but most of the instabilities
I identified through Trial and Error corresponded to this case.</p>
<p>For this limit case:</p>
<ul>
<li>$<code>R = \frac{\Delta x}{\lambda}</code>$</li>
<li>$<code>C = \rho  c_p  \Delta x</code>$</li>
</ul>
<p>thus the value of $<code>\overline{K}^{\star}</code>$ is:</p>
<div class="example-wrap"><pre class="language-math"><code>\overline{K}^{\star}=\begin{bmatrix}
-\frac{\Delta t}{C\times R} - \frac{\Delta t}{C\times R_s} &amp; \frac{\Delta t}{C\times R} \\
 \frac{\Delta t}{C\times R} &amp; -\frac{\Delta t}{C\times R} - \frac{\Delta t}{C\times R_s}\\
\end{bmatrix}   </code></pre></div>
<p>Note that, in that equation, $<code>R_{si} = R_{so}</code>$. The reason for this is that this method
does not know the real values of $<code>R_{si}</code>$ and $<code>R_{so}</code>$, so it simply using a placeholder
value low enough to cover most general cases (<code>0.05</code>).</p>
<p>Then, it can be found that the eigenvaues of this case—which we are treating as the limit case—are:</p>
<div class="example-wrap"><pre class="language-math"><code>\xi_1 = -\frac{\Delta t} { R_s \rho c_p \Delta x }</code></pre></div><div class="example-wrap"><pre class="language-math"><code>\xi_2 = \xi_1 - 2 \frac{\Delta t \lambda}{ \rho  c_p  {\Delta x}^2}</code></pre></div>
<p>Both these values are always negative, so we don’t need to worry about
$<code>\xi_i &lt; 0 </code>$. Also, it can be noticed that $<code>\xi_2 &lt; \xi_1</code>$, meaning that
what we need to comply with for Euler’s stability criteria is:</p>
<div class="example-wrap"><pre class="language-math"><code>-\frac{\Delta t} { R_s \rho c_p \Delta x } - 2 \frac{\Delta t \lambda}{ \rho  c_p  {\Delta x}^2} &lt; -2</code></pre></div>
<p>Which means that the chosen $<code>\Delta x</code>$ must be greater than the (apparently only) positive
solution to equation:</p>
<div class="example-wrap"><pre class="language-math"><code>0 = 2 {\Delta x}^2 - \left( \frac{\Delta t}{\rho c_p R_s} \right) \Delta x - \frac{2 \Delta t \lambda}{\rho c_p}</code></pre></div>
<p>So, this method will identify a combination of $<code>\Delta t</code>$ and $<code>\Delta x</code>$ that
allows complying with this</p>
<p>All that said, the value for $<code>\Delta t</code>$ actually used by the final model is
actually half of what these equations use. This is because what we are using
is a heuristic and I want to be safe… ish</p>
</div></details><details class="rustdoc-toggle method-toggle" open><summary><section id="method.get_k_q" class="method has-srclink"><span class="rightside"><a class="srclink" href="../../src/thermal/construction.rs.html#576-684">source</a></span><a href="#method.get_k_q" class="anchor"></a><h4 class="code-header">pub fn <a href="#method.get_k_q" class="fnname">get_k_q</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;ini: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;fin: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;temperatures: &amp;Matrix, <br>&nbsp;&nbsp;&nbsp;&nbsp;front_env: &amp;<a class="struct" href="../environment/struct.Environment.html" title="struct thermal::environment::Environment">Environment</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;front_emmisivity: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;front_hs: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;back_env: &amp;<a class="struct" href="../environment/struct.Environment.html" title="struct thermal::environment::Environment">Environment</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;back_emmisivity: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;back_hs: <a class="type" href="../type.Float.html" title="type thermal::Float">Float</a><br>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(</a>Matrix, Matrix<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">)</a></h4></section></summary><div class="docblock"><p>Produces $<code>\overline{K}</code>$ and $<code>\vec{q}</code>$ (as in the equation $<code>\overline{C} \dot{\vec{T}} =  \overline{K} \vec{T} + \vec{q}</code>$),
allowing to update the node temperatures in a surface. This method returns the matrix $<code>\overline{k}</code>$
representing the thermal network, and the vector $<code>\vec{q}</code>$), accounting for the heat flows induced by the
environment.</p>
<h5 id="how-it-works"><a href="#how-it-works">How it works</a></h5>
<p>This matrix is constructed based ona discretization of the layers of the
construction; that is, each layer is subdivided into <code>n</code> elements all of equal
thickness. One node is placed at the beginning and end of each elements. Each element can
be represented by the 2x2 matrix</p>
<div class="example-wrap"><pre class="language-math"><code>\overline{K}=\begin{bmatrix} -U &amp; U \\
U &amp; -U
\end{bmatrix}   </code></pre></div>
<p>Then—ignoring all external inputs (i.e., a system disconnected from the environment—the K matrix
for a construction subdivided into 3 elements (i.e., 4 nodes) can be written as follows:</p>
<div class="example-wrap"><pre class="language-math"><code>\overline{K}=\begin{bmatrix}
-U_{1\rightarrow2} &amp; U_{1\rightarrow2} &amp; 0 &amp; 0 \\
U_{1\rightarrow2} &amp; -U_{1\rightarrow2} - U_{2\rightarrow3} &amp; U_{2\rightarrow3} &amp; 0 \\
0 &amp; U_{2\rightarrow3} &amp; -U_{2\rightarrow3} - U_{3\rightarrow4} &amp; U_{3\rightarrow4} \\
0 &amp; 0 &amp; U_{3\rightarrow4} &amp; -U_{3\rightarrow4} \\
\end{bmatrix}   </code></pre></div>
<p>Now, these nodes are also connected to a front and back border conditions.
This means that the Matrix $<code>\overline{K}</code>$ needs to become:</p>
<div class="example-wrap"><pre class="language-math"><code>\overline{K}=\begin{bmatrix}
-U_{1\rightarrow2} - h_{so} &amp; U_{1\rightarrow2} &amp; 0 &amp; 0 \\
U_{1\rightarrow2} &amp; -U_{1\rightarrow2} - U_{2\rightarrow3} &amp; U_{2\rightarrow3} &amp; 0 \\
0 &amp; U_{2\rightarrow3} &amp; -U_{2\rightarrow3} - U_{3\rightarrow4} &amp; U_{3\rightarrow4} \\
0 &amp; 0 &amp; U_{3\rightarrow4} &amp; -U_{3\rightarrow4}- h_{si} \\
\end{bmatrix}   </code></pre></div>
<p>Additionally, the vector $<code>\vec{q}</code>$ will have to account for the border conditions. How this is done depends
on the border condition. If the border leads to a zone, a value of $<code>  T_{env} h_s + E_{ir}\epsilon_s - \epsilon_s \sigma {T_s}^4</code>$
should be added to $<code>\vec{q}</code>$.  Note that $<code>T_{env}</code>$ is the temparture of the air in the environment,
$<code>h_s</code>$ is the convection coefficient, $<code>E_{ir}</code>$ is the incident infrared radiation and $<code>\epsilon_s</code>$ is the
emmisivity of the surface. On the contrary, if the border condition is a cavity, then a value of $<code>T_{pane} U_{cavity}</code>$
should be added. $<code>T_{pane}</code>$ is the temperature of the surface before or after.</p>
</div></details></div></details></div><h2 id="synthetic-implementations" class="small-section-header">Auto Trait Implementations<a href="#synthetic-implementations" class="anchor"></a></h2><div id="synthetic-implementations-list"><section id="impl-RefUnwindSafe" class="impl has-srclink"><a href="#impl-RefUnwindSafe" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.RefUnwindSafe.html" title="trait core::panic::unwind_safe::RefUnwindSafe">RefUnwindSafe</a> for <a class="struct" href="struct.Discretization.html" title="struct thermal::construction::Discretization">Discretization</a></h3></section><section id="impl-Send" class="impl has-srclink"><a href="#impl-Send" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> for <a class="struct" href="struct.Discretization.html" title="struct thermal::construction::Discretization">Discretization</a></h3></section><section id="impl-Sync" class="impl has-srclink"><a href="#impl-Sync" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> for <a class="struct" href="struct.Discretization.html" title="struct thermal::construction::Discretization">Discretization</a></h3></section><section id="impl-Unpin" class="impl has-srclink"><a href="#impl-Unpin" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Unpin.html" title="trait core::marker::Unpin">Unpin</a> for <a class="struct" href="struct.Discretization.html" title="struct thermal::construction::Discretization">Discretization</a></h3></section><section id="impl-UnwindSafe" class="impl has-srclink"><a href="#impl-UnwindSafe" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.UnwindSafe.html" title="trait core::panic::unwind_safe::UnwindSafe">UnwindSafe</a> for <a class="struct" href="struct.Discretization.html" title="struct thermal::construction::Discretization">Discretization</a></h3></section></div><h2 id="blanket-implementations" class="small-section-header">Blanket Implementations<a href="#blanket-implementations" class="anchor"></a></h2><div id="blanket-implementations-list"><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Any" class="impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/any.rs.html#132-136">source</a></span><a href="#impl-Any" class="anchor"></a><h3 class="code-header in-band">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html" title="trait core::any::Any">Any</a> for T <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;T: 'static + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span></h3></section></summary><div class="impl-items"><details class="rustdoc-toggle method-toggle" open><summary><section id="method.type_id" class="method trait-impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/any.rs.html#133">source</a></span><a href="#method.type_id" class="anchor"></a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html#tymethod.type_id" class="fnname">type_id</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/any/struct.TypeId.html" title="struct core::any::TypeId">TypeId</a></h4></section></summary><div class='docblock'><p>Gets the <code>TypeId</code> of <code>self</code>. <a href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html#tymethod.type_id">Read more</a></p>
</div></details></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Borrow%3CT%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#209-214">source</a></span><a href="#impl-Borrow%3CT%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html" title="trait core::borrow::Borrow">Borrow</a>&lt;T&gt; for T <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;T: ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span></h3></section></summary><div class="impl-items"><details class="rustdoc-toggle method-toggle" open><summary><section id="method.borrow" class="method trait-impl has-srclink"><span class="rightside"><span class="since" title="const unstable">const: <a href="https://github.com/rust-lang/rust/issues/91522" title="Tracking issue for const_borrow">unstable</a></span> · <a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#211">source</a></span><a href="#method.borrow" class="anchor"></a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html#tymethod.borrow" class="fnname">borrow</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>T</h4></section></summary><div class='docblock'><p>Immutably borrows from an owned value. <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html#tymethod.borrow">Read more</a></p>
</div></details></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-BorrowMut%3CT%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#218-222">source</a></span><a href="#impl-BorrowMut%3CT%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html" title="trait core::borrow::BorrowMut">BorrowMut</a>&lt;T&gt; for T <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;T: ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span></h3></section></summary><div class="impl-items"><details class="rustdoc-toggle method-toggle" open><summary><section id="method.borrow_mut" class="method trait-impl has-srclink"><span class="rightside"><span class="since" title="const unstable">const: <a href="https://github.com/rust-lang/rust/issues/91522" title="Tracking issue for const_borrow">unstable</a></span> · <a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#219">source</a></span><a href="#method.borrow_mut" class="anchor"></a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut" class="fnname">borrow_mut</a>(&amp;mut self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>T</h4></section></summary><div class='docblock'><p>Mutably borrows from an owned value. <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut">Read more</a></p>
</div></details></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-From%3CT%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#557-562">source</a></span><a href="#impl-From%3CT%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt; for T</h3></section></summary><div class="impl-items"><details class="rustdoc-toggle method-toggle" open><summary><section id="method.from" class="method trait-impl has-srclink"><span class="rightside"><span class="since" title="const unstable">const: <a href="https://github.com/rust-lang/rust/issues/88674" title="Tracking issue for const_convert">unstable</a></span> · <a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#559">source</a></span><a href="#method.from" class="anchor"></a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html#tymethod.from" class="fnname">from</a>(t: T) -&gt; T</h4></section></summary><div class="docblock"><p>Returns the argument unchanged.</p>
</div></details></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Into%3CU%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#541-552">source</a></span><a href="#impl-Into%3CU%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;U&gt; for T <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt;,&nbsp;</span></h3></section></summary><div class="impl-items"><details class="rustdoc-toggle method-toggle" open><summary><section id="method.into" class="method trait-impl has-srclink"><span class="rightside"><span class="since" title="const unstable">const: <a href="https://github.com/rust-lang/rust/issues/88674" title="Tracking issue for const_convert">unstable</a></span> · <a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#549">source</a></span><a href="#method.into" class="anchor"></a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html#tymethod.into" class="fnname">into</a>(self) -&gt; U</h4></section></summary><div class="docblock"><p>Calls <code>U::from(self)</code>.</p>
<p>That is, this conversion is whatever the implementation of
<code><a href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="From">From</a>&lt;T&gt; for U</code> chooses to do.</p>
</div></details></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-TryFrom%3CU%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#598-607">source</a></span><a href="#impl-TryFrom%3CU%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt; for T <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;T&gt;,&nbsp;</span></h3></section></summary><div class="impl-items"><details class="rustdoc-toggle" open><summary><section id="associatedtype.Error" class="type trait-impl has-srclink"><a href="#associatedtype.Error" class="anchor"></a><h4 class="code-header">type <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" class="associatedtype">Error</a> = <a class="enum" href="https://doc.rust-lang.org/nightly/core/convert/enum.Infallible.html" title="enum core::convert::Infallible">Infallible</a></h4></section></summary><div class='docblock'><p>The type returned in the event of a conversion error.</p>
</div></details><details class="rustdoc-toggle method-toggle" open><summary><section id="method.try_from" class="method trait-impl has-srclink"><span class="rightside"><span class="since" title="const unstable">const: <a href="https://github.com/rust-lang/rust/issues/88674" title="Tracking issue for const_convert">unstable</a></span> · <a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#604">source</a></span><a href="#method.try_from" class="anchor"></a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#tymethod.try_from" class="fnname">try_from</a>(value: U) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;T, &lt;T as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'><p>Performs the conversion.</p>
</div></details></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-TryInto%3CU%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#583-592">source</a></span><a href="#impl-TryInto%3CU%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html" title="trait core::convert::TryInto">TryInto</a>&lt;U&gt; for T <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;,&nbsp;</span></h3></section></summary><div class="impl-items"><details class="rustdoc-toggle" open><summary><section id="associatedtype.Error-1" class="type trait-impl has-srclink"><a href="#associatedtype.Error-1" class="anchor"></a><h4 class="code-header">type <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html#associatedtype.Error" class="associatedtype">Error</a> = &lt;U as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a></h4></section></summary><div class='docblock'><p>The type returned in the event of a conversion error.</p>
</div></details><details class="rustdoc-toggle method-toggle" open><summary><section id="method.try_into" class="method trait-impl has-srclink"><span class="rightside"><span class="since" title="const unstable">const: <a href="https://github.com/rust-lang/rust/issues/88674" title="Tracking issue for const_convert">unstable</a></span> · <a class="srclink" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#589">source</a></span><a href="#method.try_into" class="anchor"></a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html#tymethod.try_into" class="fnname">try_into</a>(self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;U, &lt;U as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'><p>Performs the conversion.</p>
</div></details></div></details></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="thermal" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.0-nightly (52ca603da 2022-04-12)" ></div>
</body></html>